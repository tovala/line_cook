version: 2

models:
  - name: dry_payment_line_item
    # The various PLI types should always be consistent wrt the invoice and transaction amounts
    data_tests:
      - expression_is_true: 
          arguments:
            expression: "(invoice_amount_cents >= 0 AND transaction_amount_cents >= 0)"
            condition: "type = 'charge'"
      - expression_is_true: 
          arguments:
            expression: "(invoice_amount_cents < 0 AND transaction_amount_cents <= 0)"
            condition: "type = 'discount'"
      - expression_is_true: 
          arguments:
            expression: "(invoice_amount_cents < 0 AND transaction_amount_cents <= 0)"
            condition: "type = 'meal_cash'"
      - expression_is_true: 
          arguments:
            expression: "invoice_amount_cents = transaction_amount_cents AND (transaction_amount_cents < 0 AND invoice_amount_cents < 0)"
            condition: "type = 'refund'"
      - expression_is_true: 
          arguments:
            expression: "(invoice_amount_cents >= 0 AND transaction_amount_cents = 0)"
            condition: "type = 'shipping'"
      - expression_is_true: 
          arguments:
            expression: "(invoice_amount_cents >= 0 AND transaction_amount_cents = 0)"
            condition: "type IN ('sku', 'sku_menuproduct')"
      - expression_is_true:
          arguments: 
            expression: "(invoice_amount_cents >= 0 AND transaction_amount_cents >= 0)"
            condition: "type = 'tax'"
    columns:
      - name: id
        data_tests:
          - primary_key
      - name: updated
        data_tests:
          - not_null
