version: 2

models:
  - name: customer_term_summary
    description: "Customer-level term summary account"
    columns:
      - name: customer_id
        data_tests:
          - not_null
      - name: term_id
        data_tests:
          - not_null
      - name: customer_term_id 
        data_tests:
          - primary_key
      - name: is_internal_account
        data_tests:
          - not_null # sanity check that there are no customers missing from customers table
      - name: cycle
        data_tests:
          - not_null
      - name: meal_order_id
        data_tests:
          # A customer should always have a meal_order_id if they are active
          - expression_is_true:
              arguments:
                expression: "IS NOT NULL"
                condition: "subscription_status = 'active'"
          # A customer should never have a meal_order_id if they are inactive
          - expression_is_true:
              arguments:
                expression: "IS NULL"
                condition: "subscription_status IN ('paused', 'canceled')"