version: 2

models:
  - name: subterms
    data_tests:
      # Ensures that there are no terms that have shipped for which we do not have a shipping file
      - except_equality:
          arguments:
            compare_model: "dry.shipment_file"
            is_distinct: True
            model_columns: [term_id, cycle, facility_network]
            compare_model_columns: [term_id, cycle_id, facility_network]    
            model_condition: "is_available AND term_id > 136 AND term_id IN (SELECT term_id FROM {{ ref('terms') }} WHERE NOT has_no_orders AND NOT is_editable)"
    columns:
      - name: cycle
        data_tests:
          - not_null 
          - accepted_values:
              arguments:
                values: [1, 2]
      - name: facility_network
        data_tests:
          - not_null 
          - accepted_values:
              arguments:
                values: ['chicago', 'slc']
