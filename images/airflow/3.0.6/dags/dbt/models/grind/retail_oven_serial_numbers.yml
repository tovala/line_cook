version: 2

models:
  - name: retail_oven_serial_numbers
    data_tests: 
      # Test to ensure that there are no uncategorized internal_roadshow_ids
      - except_equality:
          arguments:
            compare_model: source('mold', 'costco_roadshows')
            model_columns: [internal_roadshow_id]
            model_condition: "retailer = 'costco'"
            is_distinct: True
    columns:
      - name: serial_number
        data_tests:
          - primary_key
      - name: ship_date
        data_tests:
          - not_null
      - name: retailer
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['amazon', 'qvc', 'costco']
      - name: internal_roadshow_id
        data_tests:
            # Every Costco oven should have an internal_roadshow_id
            - expression_is_true:
                arguments:
                  expression: "IS NOT NULL"
                  condition: "retailer = 'costco'"
            # Non-Costco ovens should not
            - expression_is_true:
                arguments:
                  expression: "IS NULL"
                  condition: "retailer <> 'costco'"
